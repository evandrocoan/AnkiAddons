<!-- https://gist.github.com/evandrocoan/0e25dd233f3f99352a8147041809ba8d -->
<div class="meanings-wrapper">
  <div class="meaning-tags">Noun</div>
  <div class="meaning-wrapper">
    <div class="meaning-definition zero-padding">
      <span class="meaning-definition-section_divider">1. </span>
      <span class="meaning-meaning">yen (Japanese monetary unit)</span>
      <span>​</span>
    </div>
    <span class="sentences zero-padding">
      <div class="sentence" style="">
        <ul class="japanese japanese_gothic clearfix" lang="ja">
          <li class="clearfix"><span class="furigana">わたし</span><span class="unlinked">私</span></li>
          <li class="clearfix"><span class="unlinked">は</span></li>
          <li class="clearfix"><span class="unlinked">その</span></li>
          <li class="clearfix"><span class="unlinked">レコード</span></li>
          <li class="clearfix"><span class="unlinked">を</span></li>
          <li class="clearfix"><span class="furigana">か</span><span class="unlinked">買う</span></li>
          <li class="clearfix"><span class="unlinked">のに</span></li>
          ３０００
          <li class="clearfix"><span class="furigana">えん</span><span class="unlinked"><span class="hit">円</span></span></li>
          <li class="clearfix"><span class="unlinked">かかった</span></li>
          。
        </ul>
        <span class="english" lang="en">It cost me 3,000 yen to buy the record.</span>
      </div>
    </span>
  </div>
  <div class="meaning-tags">Noun</div>
  <div class="meaning-wrapper">
    <div class="meaning-definition zero-padding">
      <span class="meaning-definition-section_divider">2. </span>
      <span class="meaning-meaning">circle</span>
      <span>​</span>
    </div>
    <span class="sentences zero-padding">
      <div class="sentence" style="">
        <ul class="japanese japanese_gothic clearfix" lang="ja">
          <li class="clearfix"><span class="furigana">かんぜん</span><span class="unlinked">完全な</span></li>
          <li class="clearfix"><span class="furigana">えん</span><span class="unlinked"><span class="hit">円</span></span></li>
          <li class="clearfix"><span class="unlinked">には</span></li>
          <li class="clearfix"><span class="unlinked">もう</span></li>
          <li class="clearfix"><span class="furigana">み</span><span class="unlinked">見えない</span></li>
          <li class="clearfix"><span class="unlinked">の</span></li>
          <li class="clearfix"><span class="unlinked">である</span></li>
          。
        </ul>
        <span class="english" lang="en">It no longer seems to be a perfect circle.</span>
      </div>
    </span>
  </div>
  <div class="meaning-tags">Wikipedia definition</div>
  <div class="meaning-wrapper">
    <div class="meaning-definition zero-padding">
      <span class="meaning-definition-section_divider">3. </span>
      <span class="meaning-meaning">圓</span>
      <span>​</span>
    </div>
  </div>
  <div class="meaning-tags">Other forms</div>
  <div class="meaning-wrapper">
    <div class="meaning-definition zero-padding">
      <span class="meaning-meaning"><span class="break-unit">圓 【えん】</span></span>
    </div>
  </div>
  <div class="meaning-tags">Notes</div>
  <div class="meaning-wrapper">
    <div class="meaning-definition meaning-representation_notes zero-padding">
      <span class="">圓: Out-dated kanji or kanji usage.</span>
    </div>
  </div>
  <button>Copy</button>
</div>

<button onclick="cleanHtmlTags()">Add color to tags</button>

<script>
    function copyToClipboard(docCopy) {
        const meaningTags = docCopy.querySelectorAll('.meaning-tags');

        for (let i = 0; i < meaningTags.length; i++) {
            const tagContent = meaningTags[i].textContent;
            if (tagContent) {
                const newTag = document.createElement('span');
                newTag.style.color = 'rgb(0, 128, 0)';
                newTag.innerHTML = tagContent + ') ';
                newTag.classList = meaningTags[i].classList;
                meaningTags[i].parentNode.insertBefore(newTag, meaningTags[i]);
                meaningTags[i].parentNode.removeChild(meaningTags[i]);
            }
        }

        const meaningDefinitions = docCopy.querySelectorAll('.meaning-definition');
        for (let i = 0; i < meaningDefinitions.length; i++) {
            const meaningDefinition = meaningDefinitions[i];

            // remove `class="meaning-definition-section_divider"` and its contents
            const sectionDivider = meaningDefinition.querySelector('.meaning-definition-section_divider');
            if (sectionDivider) {
                sectionDivider.parentNode.removeChild(sectionDivider);
            }
        }

        // before the `class="supplemental_info"` and after `class="meaning-meaning` span tag closes, add `: `
        const spanElements = docCopy.querySelectorAll('span');
        for (let i = 0; i < spanElements.length; i++) {
            const spanElement = spanElements[i];
            if( !spanElement.parentNode ) {
                continue;
            }

            if (spanElement.textContent === '​' && spanElement.parentNode.nextSibling !== null && spanElement.parentNode !== null) {
                const textNode = document.createTextNode(': ');
                spanElement.parentNode.replaceChild(textNode, spanElement);
            }
        }

        // replace `ul class="japanese` and its contents with new formating using `<ruby><rb>kanji</rb><rt>furigana</rt></ruby>`
        const japaneseLists = docCopy.querySelectorAll('.japanese');
        for (let i = 0; i < japaneseLists.length; i++) {
            const japaneseListItems = japaneseLists[i].querySelectorAll('li');
            for (let j = 0; j < japaneseListItems.length; j++) {
                const japaneseListItem = japaneseListItems[j];
                const kanji = japaneseListItem.querySelector('.unlinked');
                const furigana = japaneseListItem.querySelector('.furigana');
                if (kanji && furigana) {
                    const ruby = document.createElement('ruby');
                    const rt = document.createElement('rt');
                    rt.innerHTML = furigana.innerHTML;
                    ruby.insertAdjacentHTML('beforeend', kanji.innerHTML)
                    ruby.appendChild(rt);
                    japaneseListItem.innerHTML = '';
                    japaneseListItem.appendChild(ruby);
                }
                else if(kanji) {
                    const ruby = document.createElement('ruby');
                    const rt = document.createElement('rt');
                    ruby.insertAdjacentHTML('beforeend', kanji.innerHTML)
                    ruby.appendChild(rt);
                    japaneseListItem.innerHTML = '';
                    japaneseListItem.appendChild(ruby);
                }
            }
        }

        // add `<br/>` after `class="meaning-wrapper"` contents but not if it is the last one
        const meaningWrappers = docCopy.querySelectorAll('.meaning-wrapper');
        for (let i = 0; i < meaningWrappers.length; i++) {
            const meaningWrapper = meaningWrappers[i];
            const contents = meaningWrapper.innerHTML;
            if (i < meaningWrappers.length - 1) {
                meaningWrapper.insertAdjacentElement('afterEnd', document.createElement('br'));
            }

            // remove ul and li but keep its contents
            const sentences = meaningWrapper.querySelector('.sentences');
            if(!sentences) {
                continue;
            }
            const japanese = sentences.querySelector('.japanese');
            const japaneseListItems = japanese.childNodes;
            const japaneseListItemContents = [];

            for(let i = 0; i < japaneseListItems.length; i++) {
                const japaneseListItem = japaneseListItems[i];
                if(japaneseListItem.nodeType === Node.TEXT_NODE) {
                    japaneseListItemContents.push(japaneseListItem.textContent);
                }
                else {
                    japaneseListItemContents.push(japaneseListItem.innerHTML);
                }
            };
            const newHtml = document.createElement('span');
            newHtml.innerHTML = japaneseListItemContents.join('');
            newHtml.classList = 'japanese-chars';
            japanese.parentElement.replaceChild(newHtml, japanese);
        }

        // move `class="english"` contents from inside `class="sentence"` to after it
        const sentences = docCopy.querySelectorAll('.sentence');
        for (let i = 0; i < sentences.length; i++) {
            const sentence = sentences[i];
            const english = sentence.querySelector('.english');
            if (english) {
                const englishText = english.textContent;
                sentence.removeChild(english);
                const newSpan = document.createElement('span');
                newSpan.classList.add('english');
                newSpan.textContent = englishText;
                sentence.parentNode.appendChild(newSpan);
            }
        }

        // replace all `div` tags by `span`, except the class="meaning-tags" div
        let divs = docCopy.querySelectorAll('div');
        while (divs.length > 0) {
            for (let i = 0; i < divs.length; i++) {
                const div = divs[i];
                if (!div.classList.contains('meaning-tags')) {
                    const span = document.createElement('span');
                    span.innerHTML = div.innerHTML;
                    div.parentNode.replaceChild(span, div);
                }
            }
            divs = docCopy.querySelectorAll('div');
        }

        const removeButtons = docCopy.querySelectorAll('.remove-this-button');
        removeButtons.forEach(button => {
            button.remove();
        });

        const html = docCopy.outerHTML;
        navigator.clipboard.writeText(html)
        .then(() => {
            if (Notification.permission === 'granted') {
                const notification = new Notification('HTML copied to clipboard', {
                    body: 'The HTML has been copied to the clipboard.',
                });
                setTimeout(() => {
                    notification.close();
                }, 3000);
            } else if (Notification.permission !== 'denied') {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        const notification = new Notification('HTML copied to clipboard', {
                            body: 'The HTML has been copied to the clipboard.',
                        });
                        setTimeout(() => {
                            notification.close();
                        }, 3000);
                    }
                    else {
                        alert('Clipboard copy notification show denied');
                    }
                });
            }
        })
        .catch(err => {
            alert('Failed to copy HTML: ', err);
        });
    }

    function cleanHtmlTags() {
        const meaningsWrappers = document.querySelectorAll('.meanings-wrapper');
        meaningsWrappers.forEach(meaningsWrapper => {
            copyToClipboard(meaningsWrapper);
            // copyToClipboard(meaningsWrapper.cloneNode(true));
        });
    }
</script>
